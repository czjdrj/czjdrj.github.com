<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no"/>
	<title>maps-web API</title>
	<script>
		window.onerror = function (errMsg, scriptURI, lineNumber, columnNumber, errorObj) {
		    setTimeout(function () {
		        var rst = {
		            "错误信息：": errMsg,
		            "出错文件：": scriptURI,
		            "出错行号：": lineNumber,
		            "出错列号：": columnNumber,
		            "错误详情：": errorObj
		        };
		        alert(JSON.stringify(rst, null, 10));
		    });
		};
	</script>
	<script>
		(function(win,doc){
			function change(){
				//屏幕宽度/375*50 = font-size
				doc.documentElement.style.fontSize=doc.documentElement.clientWidth/375*50+"px";
				console.log("屏幕宽度："+doc.documentElement.clientWidth);
				console.log("根字体大小："+doc.documentElement.style.fontSize);
			}
			change();
			win.addEventListener("resize",change,false);
		})(window,document);
	</script>
	<style>
		*{
			padding:0;
			margin:0;
			list-style:none;
		}
		div{
			font-size:.3rem;
		}
		.mg-b{
			margin-bottom:.5rem;
		}
		.img-wrap{
			display:block;
		}
		.img-wrap img{
			width:100%;
		}
	</style>
</head>
<body>
	<div id="h5Lng">h5经度：</div>
	<div id="h5Lat" class="mg-b">h5纬度：</div>

	<div id="bdLng">百度经度：</div>
	<div id="bdLat">百度纬度：</div>
	<div id="bdCountry">国家：</div>
	<div id="bdCity">城市：</div>
	<div id="bdDetial" class="mg-b">地址：</div>

	<div>百度静态地图：</div>
	<a id="bdImgWrap" class="img-wrap mg-b" href="">
		<img id="bdImg" src="" alt="map">
	</a>

<!-- 	<div id="gdLng">高德经度：</div>
	<div id="gdLat">高德纬度：</div>
	<div id="gdCountry">国家：</div>
	<div id="gdCity">城市：</div>
	<div id="gdDetial" class="mg-b">地址：</div> -->

	<script src="js/jquery.min.js"></script>
	<script>
		//h5经纬度
		var h5Lng = "",
		    h5Lat = "";

		//百度经纬度
		var bdLng = "",
		    bdLat = "";

		// //高德经纬度
		// var gdLng = "",
		//     gdLat = "";

		//百度位置
		var bdPos = {
			country:"",
			city:"",
			detial:""
		}

		// //高德位置
		// var gdPos = {
		// 	country:"",
		// 	city:"",
		// 	detial:""
		// }

		var getGpsPos = function(success,error,none){
			//h5 转 百度定位
			if(navigator.geolocation){
				//浏览器是否支持定位
				navigator.geolocation.getCurrentPosition(//获取经纬度
					function(ev){//成功
						console.log(ev.coords);
						h5Lng = ev.coords.longitude;
						h5Lat = ev.coords.latitude;
						success && success(h5Lng,h5Lat);
					},function(ev){//失败
						error && error();
					},{
						enableHighAcuracy: true,//是否需要高精度获取位置，默认false   
						timeout: 5000,//超时时间，单位为毫秒，默认0
						maximumAge: 5000//位置信息的缓存时间，默认0
				});
			}else{
				none && none();
			}
		}

		var bdChangeAndGet = function(h5Lng,h5Lat){
			//百度web API，h5经纬度 转换成 百度经纬度
			$.ajax({
			    type:"post",
			    url:"https://api.map.baidu.com/geoconv/v1/?ak=IHzbZKoki4dDrMrxslIdYHLIcAsUEmip&coords=" + h5Lng + "," + h5Lat + "&from=1&to=5&output=json",
			    dataType:"jsonp",
			    jsonp:"callback",
			    success:function(res){
			        console.log(res);
			        bdLng = res.result[0].x;
			        bdLat = res.result[0].y;
			        $("#bdLng").html("百度经度：" + bdLng);
			        $("#bdLat").html("百度纬度：" + bdLat);

			        //百度web API，传入经纬度 获取 地理位置信息
				    $.ajax({
				        type:"post",
				        url:"https://api.map.baidu.com/geocoder/v2/?ak=IHzbZKoki4dDrMrxslIdYHLIcAsUEmip&location=" + bdLat + "," + bdLng + "&output=json&pois=1",
				        dataType:"jsonp",
				        jsonp:"callback",
				        success:function(res){
				            console.log(res);
				            bdPos.country = res.result.addressComponent.country;
				            bdPos.city = res.result.addressComponent.city;
				            bdPos.detial = res.result.formatted_address;
				            $("#bdCountry").html("国家：" + bdPos.country);
				            $("#bdCity").html(" 城市：" + bdPos.city);
				            $("#bdDetial").html("地址：" + bdPos.detial);

					        //地图
					        $("#bdImg").attr("src","https://api.map.baidu.com/staticimage/v2?ak=IHzbZKoki4dDrMrxslIdYHLIcAsUEmip&center="+bdLng+","+bdLat+"&markers="+bdLng+","+bdLat+"&markerStyles=l,A,0xFF0000&width=750&height=500&zoom=18");
					        //跳转链接
					        $("#bdImgWrap").attr("href","https://api.map.baidu.com/marker?location="+bdLat+","+bdLng+"&title=我的位置&content="+bdPos.detial+"&output=html&src=测试 ");
				        },
				        error:function(){
				            alert("连接超时");
				        }
				    });
			    },
			    error:function(){
			        alert("连接超时");
			    }
			});
		}

		// var gdChangeAndGet = function(h5Lng,h5Lat){
		// 	//高德web API，h5经纬度 转换成 高德经纬度
		// 	$.ajax({
		// 	    type:"post",
		// 	    url:"https://restapi.amap.com/v3/assistant/coordinate/convert?key=9dea08e4e80545b8186fca81b9faeef6&locations=" + h5Lng + "," + h5Lat + "&coordsys=gps&output=json",
		// 	    dataType:"jsonp",
		// 	    jsonp:"callback",
		// 	    success:function(res){
		// 	        console.log(res);
		// 	        gdLng = res.locations.split(",")[0];
		// 	        gdLat = res.locations.split(",")[1];
		// 	        $("#gdLng").html("高德经度：" + gdLng);
		// 	        $("#gdLat").html("高德纬度：" + gdLat);
		// 	        //高德web API，传入经纬度 获取 地理位置信息
		// 			$.ajax({
		// 			    type:"post",
		// 			    url:"https://restapi.amap.com/v3/geocode/regeo?key=9dea08e4e80545b8186fca81b9faeef6&location=" + gdLng + "," + gdLat + "&output=json&extensions=all",
		// 			    dataType:"jsonp",
		// 			    jsonp:"callback",
		// 			    success:function(res){
		// 			        console.log(res);
		// 			        gdPos.country = res.regeocode.addressComponent.country;
		// 			        gdPos.city = res.regeocode.addressComponent.city;
		// 			        gdPos.detial = res.regeocode.formatted_address;
		// 		            $("#gdCountry").html("国家：" + gdPos.country);
		// 		            $("#gdCity").html(" 城市：" + gdPos.city);
		// 		            $("#gdDetial").html("地址：" + gdPos.detial);
		// 			    },
		// 			    error:function(){
		// 			        alert("连接超时");
		// 			    }
		// 			});
		// 	    },
		// 	    error:function(){
		// 	        alert("连接超时");
		// 	    }
		// 	});
		// }

		getGpsPos(function(h5Lng,h5Lat){
			$("#h5Lng").html("h5经度：" + h5Lng);
			$("#h5Lat").html("h5纬度：" + h5Lat);
			//百度转换 + 获取位置信息
			bdChangeAndGet(h5Lng,h5Lat);
		},function(){
			alert('获取地理位置信息失败，请打开GPS。');
		},function(){
			alert('您的浏览器不支持定位。');
		});

		// getGpsPos(function(h5Lng,h5Lat){
		// 	$("#h5Lng").html("h5经度：" + h5Lng);
		// 	$("#h5Lat").html("h5纬度：" + h5Lat);
		// 	//高德转换 + 获取位置信息
		// 	gdChangeAndGet(h5Lng,h5Lat);
		// },function(){
		// 	alert('获取地理位置信息失败，请打开GPS。');
		// },function(){
		// 	alert('您的浏览器不支持定位。');
		// });

	</script>
</body>
</html>